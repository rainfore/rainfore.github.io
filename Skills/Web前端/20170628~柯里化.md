---
created-date: 2015-06-28
modified-date: 2015-06-29
tags: [ 柯里化, Curry, JavaScript ]
---

## 何为Curry化/柯里化？

Curry化来源与数学家 Haskell Curry的名字 （编程语言 Haskell也是以他的名字命名）。

柯里化通常也称部分求值，其含义是给函数分步传递参数，每次传递参数后部分应用参数，并返回一个更具体的函数接受剩下的参数，这中间可嵌套多层这样的接受部分参数函数，直至返回最后结果。

## 示例

``` javascript
const currying = (fn) => {
    const args = [];
    return function cb(...restArgs) {
        if (restArgs.length === 0) {
            const result = fn(...args);
            args.length = 0;
            return result;
        }

        args.push(...restArgs);
        return cb;
    }
}

const add = (...args) => args.reduce((a, b) => a + b);

const sum = currying(add);

sum(1,2)(3);
sum(4);
sum(); // 10
```


## 柯里化的基础

上面的代码其实是一个高阶函数（high-order function）, 高阶函数是指操作函数的函数，它接收一个或者多个函数作为参数，并返回一个新函数。此外，还依赖与闭包的特性，来保存中间过程中输入的参数。即：

- 函数可以作为参数传递
- 函数能够作为函数的返回值
- 闭包

## 柯里化的作用

- 延迟计算。上面的例子已经比较好低说明了。
- 参数复用。当在多次调用同一个函数，并且传递的参数绝大多数是相同的，那么该函数可能是一个很好的柯里化候选。
- 动态创建函数。这可以是在部分计算出结果后，在此基础上动态生成新的函数处理后面的业务，这样省略了重复计算。或者可以通过将要传入调用函数的参数子集，部分应用到函数中，从而动态创造出一个新函数，这个新函数保存了重复传入的参数（以后不必每次都传）。例如，事件浏览器添加事件的辅助方法：

``` JavaScript
const addEvent = (elem, type, fn, cature) => {
    if (window.addEventListener) {
        elem.addEventListener(type, (e) => fn.call(elem, e), capture);
    } else if (window.attachEvent) {
        elem.attachEvent('on' + type, (e) => fn.call(elem, e);
    }
}
```

每次添加事件处理都要执行一遍 if...else...，其实在一个浏览器中只要一次判定就可以了，把根据一次判定之后的结果动态生成新的函数，以后就不必重新计算。

``` JavaScript
const addEvent = (() => {
    if (window.addEventListener) {
        return (elem, type, fn, capture) => {
            elem.addEventListener(type, (e) => fn.call(elem, e), capture);
        };
    } else {
        return (elem, type, fn, capture) => {
            elem.attachEvent('on' + type, (e) => fn.call(elem, e);
        };
    }
})();
```

这个例子，第一次 if...else... 判断之后，完成了部分计算，动态创建新的函数来处理后面传入的参数，这是一个典型的柯里化。

### Function.prototype.bind 方法也是柯里化应用

与 call/apply 方法直接执行不同，bind 方法 将第一个参数设置为函数执行的上下文，其他参数依次传递给调用方法（函数的主体本身不执行，可以看成是延迟执行），并动态创建返回一个新的函数， 这符合柯里化特点。

``` javascript
const foo = { x: 123 };
const bar = function () {
    console.
}.bind(foo);
```

------

###### 参考

- [浅析 JavaScript 中的函数 currying 柯里化](http://www.cnblogs.com/zztt/p/4142891.html)
