webpackJsonp([31],{"fi/X":function(a,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var r={render:function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("u-article",[e("h1",[a._v("SourceMap详解")]),e("div",{staticClass:"u-article_meta"},[a._v("2015-03-10")]),e("p",[a._v("在这个年代，对于前端开发来说，用户浏览器的运行代码和我们写的原始代码已经很不一样了。因为我们的代码一般都要经过压缩、合并，还有的是经过Sass、Less、Stylus、CoffeeScript、TypeScript等语言的预编译。这就使代码调试变得困难重重。")]),e("p",[a._v("通常JavaScript的解释器会告诉你，第几行第几列代码出错，但这对于转换后的代码毫无用处。举例来说，"),e("code",{pre:!0},[a._v("jquery-1.11.2.js")]),a._v("压缩后只有3行，每行3万多字符，所有内部变量都改了名字。你看着报错信息，会感到毫无头绪(:晕:)，根本不知道它所对应的原始位置。")]),e("p",[a._v("SourceMap就是为了解决这个问题而生的。")]),e("h3",{attrs:{id:"示例"}},[a._v("示例 "),e("a",{staticClass:"header-anchor",attrs:{href:"#示例","aria-hidden":"true",target:"_blank"}},[a._v("¶")])]),e("p",[a._v("不说废话，先上例子。")]),e("p",[a._v("首先我们用CoffeeScript写一个阶乘函数，将文件命名为"),e("code",{pre:!0},[a._v("sample.coffee")]),a._v("：")]),e("pre",{pre:!0,attrs:{class:"hljs lang-coffee"}},[e("code",{pre:!0,attrs:{"v-pre":""}},[e("span",{pre:!0,attrs:{class:"hljs-function"}},[e("span",{pre:!0,attrs:{class:"hljs-title"}},[a._v("factorial")]),a._v(" = "),e("span",{pre:!0,attrs:{class:"hljs-params"}},[a._v("(num)")]),a._v(" ->")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[a._v("if")]),a._v(" "),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[a._v("not")]),a._v(" "),e("span",{pre:!0,attrs:{class:"hljs-regexp"}},[a._v("/^\\d+$/")]),a._v(".test(num)\n        "),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[a._v("throw")]),a._v(" "),e("span",{pre:!0,attrs:{class:"hljs-string"}},[a._v("'Error: Not an integer!'")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"hljs-function"}},[a._v("\n    "),e("span",{pre:!0,attrs:{class:"hljs-title"}},[a._v("_factorial")]),a._v(" = "),e("span",{pre:!0,attrs:{class:"hljs-params"}},[a._v("(num)")]),a._v(" ->")]),a._v("\n        "),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[a._v("return")]),a._v(" ("),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[a._v("if")]),a._v(" num <= "),e("span",{pre:!0,attrs:{class:"hljs-number"}},[a._v("1")]),a._v(" "),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[a._v("then")]),a._v(" "),e("span",{pre:!0,attrs:{class:"hljs-number"}},[a._v("1")]),a._v(" "),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[a._v("else")]),a._v(" num * _factorial(num - "),e("span",{pre:!0,attrs:{class:"hljs-number"}},[a._v("1")]),a._v("))\n\n    "),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[a._v("return")]),a._v(" _factorial(num)\n\n"),e("span",{pre:!0,attrs:{class:"hljs-built_in"}},[a._v("window")]),a._v(".factorial = factorial")])]),e("p",[a._v("然后将代码编译再压缩，会得到"),e("code",{pre:!0},[a._v("sample.min.js")]),a._v("：")]),e("pre",{pre:!0,attrs:{class:"hljs lang-javascript"}},[e("code",{pre:!0,attrs:{"v-pre":""}},[a._v("("),e("span",{pre:!0,attrs:{class:"hljs-function"}},[e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[a._v("function")]),a._v("("),e("span",{pre:!0,attrs:{class:"hljs-params"}}),a._v(")")]),a._v("{"),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[a._v("var")]),a._v(" r;r="),e("span",{pre:!0,attrs:{class:"hljs-function"}},[e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[a._v("function")]),a._v("("),e("span",{pre:!0,attrs:{class:"hljs-params"}},[a._v("r")]),a._v(")")]),a._v("{"),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[a._v("var")]),a._v(" t;"),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[a._v("if")]),a._v("(!"),e("span",{pre:!0,attrs:{class:"hljs-regexp"}},[a._v("/^\\d+$/")]),a._v(".test(r))"),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[a._v("throw")]),e("span",{pre:!0,attrs:{class:"hljs-string"}},[a._v('"Error: Not an integer!"')]),a._v(";"),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[a._v("return")]),a._v("(t="),e("span",{pre:!0,attrs:{class:"hljs-function"}},[e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[a._v("function")]),a._v("("),e("span",{pre:!0,attrs:{class:"hljs-params"}},[a._v("r")]),a._v(")")]),a._v("{"),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[a._v("return")]),a._v(" "),e("span",{pre:!0,attrs:{class:"hljs-number"}},[a._v("1")]),a._v(">=r?"),e("span",{pre:!0,attrs:{class:"hljs-number"}},[a._v("1")]),a._v(":r*t(r"),e("span",{pre:!0,attrs:{class:"hljs-number"}},[a._v("-1")]),a._v(")})(r)},"),e("span",{pre:!0,attrs:{class:"hljs-built_in"}},[a._v("window")]),a._v(".factorial=r}).call("),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[a._v("this")]),a._v(");")])]),e("p",[a._v("当需要调试时，我们的处境就是看着压缩混淆后的JS代码来修改CoffeeScript代码。")]),e("figure",[e("img",{attrs:{src:"/Skills/Web前端/20150310~SourceMap详解/screenshot/1.png",alt:""}})]),e("p",[a._v("当然，对于当前这个例子来说没多大困难，但如果是一个大工程的话，难度就不亚于看着二进制中间码来修改Java代码了。")]),e("p",[a._v("如果我们有从"),e("code",{pre:!0},[a._v("sample.coffee")]),a._v("转换到"),e("code",{pre:!0},[a._v("sample.min.js")]),a._v("对应的SourceMap文件，情况就大不一样。")]),e("p",[a._v("重新将代码编译再压缩，同时生成"),e("code",{pre:!0},[a._v("sample.min.map")]),a._v("：")]),e("pre",{pre:!0,attrs:{class:"hljs lang-json"}},[e("code",{pre:!0,attrs:{"v-pre":""}},[a._v("{"),e("span",{pre:!0,attrs:{class:"hljs-attr"}},[a._v('"version"')]),a._v(":"),e("span",{pre:!0,attrs:{class:"hljs-number"}},[a._v("3")]),a._v(","),e("span",{pre:!0,attrs:{class:"hljs-attr"}},[a._v('"file"')]),a._v(":"),e("span",{pre:!0,attrs:{class:"hljs-string"}},[a._v('"sample.min.js"')]),a._v(","),e("span",{pre:!0,attrs:{class:"hljs-attr"}},[a._v('"sources"')]),a._v(":["),e("span",{pre:!0,attrs:{class:"hljs-string"}},[a._v('"sample.coffee"')]),a._v("],"),e("span",{pre:!0,attrs:{class:"hljs-attr"}},[a._v('"names"')]),a._v(":["),e("span",{pre:!0,attrs:{class:"hljs-string"}},[a._v('"factorial"')]),a._v(","),e("span",{pre:!0,attrs:{class:"hljs-string"}},[a._v('"num"')]),a._v(","),e("span",{pre:!0,attrs:{class:"hljs-string"}},[a._v('"_factorial"')]),a._v(","),e("span",{pre:!0,attrs:{class:"hljs-string"}},[a._v('"test"')]),a._v(","),e("span",{pre:!0,attrs:{class:"hljs-string"}},[a._v('"window"')]),a._v("],"),e("span",{pre:!0,attrs:{class:"hljs-attr"}},[a._v('"mappings"')]),a._v(":"),e("span",{pre:!0,attrs:{class:"hljs-string"}},[a._v('"CAAA,WAAA,GAAAA,EAAAA,GAAY,SAACC,GACZ,GAAAC,EAAA,KAAG,QAAYC,KAAKF,GACnB,KAAM,wBAKP,QAHAC,EAAa,SAACD,GACb,MAAkB,IAAPA,EAAc,EAAOA,EAAMC,EAAWD,EAAM,KAEtCA,IAEnBG,OAAOJ,UAAYA"')]),a._v("}")])]),e("p",[a._v("然后再打开浏览器的调试工具。")]),e("p",[a._v("可以发现Sources中能够直接找到"),e("code",{pre:!0},[a._v("sample.coffee")]),a._v("原始文件，并且可以调试CoffeeScript了耶！")]),e("figure",[e("img",{attrs:{src:"/Skills/Web前端/20150310~SourceMap详解/screenshot/2.png",alt:""}})]),e("p",[a._v("妈妈再也不用担心我调试压缩混淆代码头大了(:QQ:可怜:)。"),e("a",{attrs:{href:"/Skills/Web前端/20150310~SourceMap详解/demo.zip",target:"_blank"}},[a._v("Demo下载")])]),e("h3",{attrs:{id:"什么是SourceMap-"}},[a._v("什么是SourceMap？ "),e("a",{staticClass:"header-anchor",attrs:{href:"#什么是SourceMap-","aria-hidden":"true",target:"_blank"}},[a._v("¶")])]),e("blockquote",[e("p",[a._v("Source maps offer a language-agnostic way of mapping production code to the original code that was authored.")]),e("p",[a._v("SourceMap提供了一种从生成代码到原始代码的映射方法，并且这种方法与语言无关。")])]),e("figure",[e("img",{attrs:{src:"/Skills/Web前端/20150310~SourceMap详解/figure/1.png",alt:""}})]),e("p",[a._v("简单来说，SourceMap就是一个信息文件"),e("code",{pre:!0},[a._v("sample.min.map")]),a._v("，里面储存着代码转换前后对应的位置信息，通常该文件的扩展名是"),e("code",{pre:!0},[a._v(".map")]),a._v("。")]),e("p",[a._v("如果要使用SourceMap调试代码，生成代码"),e("code",{pre:!0},[a._v("sample.min.js")]),a._v("的末尾就必须有如下注释，用于指定SourceMap的路径：")]),e("pre",{pre:!0,attrs:{class:"hljs lang-javascript"}},[e("code",{pre:!0,attrs:{"v-pre":""}},[e("span",{pre:!0,attrs:{class:"hljs-comment"}},[a._v("//# sourceMappingURL=/path/to/sample.min.map")])])]),e("p",[a._v("该注释通常由SourceMap的生成工具添加。")]),e("p",[a._v("也可以在生成代码"),e("code",{pre:!0},[a._v("sample.min.js")]),a._v("的Response Headers中设置X-SourceMap，来指定SourceMap的路径：")]),e("pre",{pre:!0,attrs:{class:"hljs"}},[e("code",{pre:!0,attrs:{"v-pre":""}},[a._v("X-SourceMap: /path/to/sample.min.map")])]),e("p",[a._v("另外也可以使用Date URI的形式来指定SourceMap：")]),e("pre",{pre:!0,attrs:{class:"hljs lang-javascript"}},[e("code",{pre:!0,attrs:{"v-pre":""}},[e("span",{pre:!0,attrs:{class:"hljs-comment"}},[a._v("//# sourceMappingURL=data:application/json;base64,Asdi...")])])]),e("p",[a._v("这样调试工具加载转换后的代码，就能找到对应的SourceMap，再根据SourceMap中的信息找到原始代码。从而我们就可以直接用原始代码调试bug和设置断点了。")]),e("h3",{attrs:{id:"浏览器支持"}},[a._v("浏览器支持 "),e("a",{staticClass:"header-anchor",attrs:{href:"#浏览器支持","aria-hidden":"true",target:"_blank"}},[a._v("¶")])]),e("p",[a._v("目前，Chrome、Firefox、Safari和IE11都支持Javascript和CSS的SourceMap了，并且默认都是启用的，你可以用下面的方式确认一下。")]),e("h4",{attrs:{id:"Chrome"}},[a._v("Chrome "),e("a",{staticClass:"header-anchor",attrs:{href:"#Chrome","aria-hidden":"true",target:"_blank"}},[a._v("¶")])]),e("p",[a._v("按"),e("key",[a._v("F12")]),a._v("打开Developer Tools，在Setting设置中找到Sources部分，选中"),e("code",{pre:!0},[a._v("Enable JavaScript source maps")]),a._v("和"),e("code",{pre:!0},[a._v("Enable CSS source maps")]),a._v("。")],1),e("figure",[e("img",{attrs:{src:"/Skills/Web前端/20150310~SourceMap详解/screenshot/3.png",alt:""}})]),e("h4",{attrs:{id:"Firefox"}},[a._v("Firefox "),e("a",{staticClass:"header-anchor",attrs:{href:"#Firefox","aria-hidden":"true",target:"_blank"}},[a._v("¶")])]),e("p",[a._v("按"),e("key",[a._v("F12")]),a._v("打开Developer Tools，在调试器Tab页的右上角找到调试器选项，选中"),e("code",{pre:!0},[a._v("显示原始来源")]),a._v("。")],1),e("figure",[e("img",{attrs:{src:"/Skills/Web前端/20150310~SourceMap详解/screenshot/4.png",alt:""}})]),e("h4",{attrs:{id:"Safari"}},[a._v("Safari "),e("a",{staticClass:"header-anchor",attrs:{href:"#Safari","aria-hidden":"true",target:"_blank"}},[a._v("¶")])]),e("p",[a._v("我木有Safari。。(:伤不起:)")]),e("h4",{attrs:{id:"IE11"}},[a._v("IE11 "),e("a",{staticClass:"header-anchor",attrs:{href:"#IE11","aria-hidden":"true",target:"_blank"}},[a._v("¶")])]),e("p",[a._v("按"),e("key",[a._v("F12")]),a._v("打开Developer Tools，在调试程序Tab页中先选择对应的JS文件，然后在上方选中"),e("code",{pre:!0},[a._v("加载已映射到此生成文件的源")]),a._v("。")],1),e("figure",[e("img",{attrs:{src:"/Skills/Web前端/20150310~SourceMap详解/screenshot/5.png",alt:""}})]),e("h3",{attrs:{id:"SourceMap的生成"}},[a._v("SourceMap的生成 "),e("a",{staticClass:"header-anchor",attrs:{href:"#SourceMap的生成","aria-hidden":"true",target:"_blank"}},[a._v("¶")])]),e("h4",{attrs:{id:"Closure"}},[a._v("Closure "),e("a",{staticClass:"header-anchor",attrs:{href:"#Closure","aria-hidden":"true",target:"_blank"}},[a._v("¶")])]),e("p",[a._v("最常用的方法是使用Google的"),e("a",{attrs:{href:"https://developers.google.com/closure/compiler",target:"_blank"}},[a._v("Closure编辑器")]),a._v("。")]),e("p",[a._v("生成命令的格式如下：")]),e("pre",{pre:!0,attrs:{class:"hljs lang-shell"}},[e("code",{pre:!0,attrs:{"v-pre":""}},[e("span",{pre:!0,attrs:{class:"hljs-meta"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"bash"}},[a._v(" java -jar compiler.jar --js=sample.js --create_source_map=sample.min.map --source_map_format=V3 --js_output_file=sample.min.js")])])]),e("p",[a._v("各个参数的意义如下：")]),e("ul",[e("li",[e("code",{pre:!0},[a._v("--js")]),a._v("：转换前的代码文件路径；")]),e("li",[e("code",{pre:!0},[a._v("--create_source_map")]),a._v("：生成的SourceMap文件路径；")]),e("li",[e("code",{pre:!0},[a._v("--source_map_format")]),a._v("：SourceMap的版本，目前一律采用V3；")]),e("li",[e("code",{pre:!0},[a._v("--js_output_file")]),a._v("：转换后的代码文件路径。")])]),e("h4",{attrs:{id:"uglifyjs"}},[a._v("uglifyjs "),e("a",{staticClass:"header-anchor",attrs:{href:"#uglifyjs","aria-hidden":"true",target:"_blank"}},[a._v("¶")])]),e("p",[a._v("uglifyjs是nodejs下的一款优秀的JS压缩优化工具，由于jQuery改用uglifyjs作为其压缩工具令其声名远播，支持SourceMap的生成。")]),e("p",[a._v("首先安装uglifyjs：")]),e("pre",{pre:!0,attrs:{class:"hljs lang-shell"}},[e("code",{pre:!0,attrs:{"v-pre":""}},[e("span",{pre:!0,attrs:{class:"hljs-meta"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"bash"}},[a._v(" npm install uglify-js -g")])])]),e("p",[a._v("然后生成命令的格式如下：")]),e("pre",{pre:!0,attrs:{class:"hljs lang-shell"}},[e("code",{pre:!0,attrs:{"v-pre":""}},[e("span",{pre:!0,attrs:{class:"hljs-meta"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"bash"}},[a._v(" uglifyjs sample.js -cm -o sample.min.js --"),e("span",{pre:!0,attrs:{class:"hljs-built_in"}},[a._v("source")]),a._v("-map=sample.min.map")])])]),e("p",[a._v("各个参数的意义如下：")]),e("ul",[e("li",[e("code",{pre:!0},[a._v("-c")]),a._v("：使用压缩器。")]),e("li",[e("code",{pre:!0},[a._v("-m")]),a._v("：使用混淆器。")]),e("li",[e("code",{pre:!0},[a._v("-o")]),a._v("：转换后的代码文件路径。")]),e("li",[e("code",{pre:!0},[a._v("--source-map")]),a._v("：生成的SourceMap文件路径；")]),e("li",[e("code",{pre:!0},[a._v("--source-map-root")]),a._v("：（可选）用于填充SourceMap文件的"),e("code",{pre:!0},[a._v("sourceRoot")]),a._v("属性。")]),e("li",[e("code",{pre:!0},[a._v("--source-map-url")]),a._v("：（可选）SourceMap的URL路径，用于添加到生成代码的注释"),e("code",{pre:!0},[a._v("//# sourceMappingURL=")]),a._v("中，默认对应"),e("code",{pre:!0},[a._v("--source-map")]),a._v("的值；")]),e("li",[e("code",{pre:!0},[a._v("--source-map-include-sources")]),a._v("：（可选）是否将原始代码的内容添加到SourceMap文件的"),e("code",{pre:!0},[a._v("sourcesContent")]),a._v("属性中。")]),e("li",[e("code",{pre:!0},[a._v("--in-source-map")]),a._v("：（可选）SourceMap输入，如果要压缩的JS是从其他原始代码生成的，就要使用这一项。")])]),e("h4",{attrs:{id:"Less"}},[a._v("Less "),e("a",{staticClass:"header-anchor",attrs:{href:"#Less","aria-hidden":"true",target:"_blank"}},[a._v("¶")])]),e("p",[a._v("首先安装Less：")]),e("pre",{pre:!0,attrs:{class:"hljs lang-shell"}},[e("code",{pre:!0,attrs:{"v-pre":""}},[e("span",{pre:!0,attrs:{class:"hljs-meta"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"bash"}},[a._v(" npm install less -g")])])]),e("p",[a._v("然后生成命令的格式如下：")]),e("pre",{pre:!0,attrs:{class:"hljs lang-shell"}},[e("code",{pre:!0,attrs:{"v-pre":""}},[e("span",{pre:!0,attrs:{class:"hljs-meta"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"bash"}},[a._v(" lessc sample.less sample.css --"),e("span",{pre:!0,attrs:{class:"hljs-built_in"}},[a._v("source")]),a._v("-map=sample.css.map")])])]),e("p",[a._v("各个参数的意义如下：")]),e("ul",[e("li",[e("code",{pre:!0},[a._v("--source-map")]),a._v("：生成的SourceMap文件路径；")]),e("li",[e("code",{pre:!0},[a._v("--source-map-rootpath")]),a._v("：（可选）用于填充SourceMap文件的"),e("code",{pre:!0},[a._v("sourceRoot")]),a._v("属性。")]),e("li",[e("code",{pre:!0},[a._v("--source-map-inline")]),a._v("：（可选）以Data URI Scheme的形式将SourceMap文件内容内嵌到css文件中。")]),e("li",[e("code",{pre:!0},[a._v("--source-map-url")]),a._v("：（可选）SourceMap的URL路径，用于添加到生成代码的注释"),e("code",{pre:!0},[a._v("//# sourceMappingURL=")]),a._v("中，默认对应"),e("code",{pre:!0},[a._v("--source-map")]),a._v("的值。")])]),e("h4",{attrs:{id:"CoffeeScript"}},[a._v("CoffeeScript "),e("a",{staticClass:"header-anchor",attrs:{href:"#CoffeeScript","aria-hidden":"true",target:"_blank"}},[a._v("¶")])]),e("p",[a._v("生成命令的格式如下：")]),e("pre",{pre:!0,attrs:{class:"hljs lang-shell"}},[e("code",{pre:!0,attrs:{"v-pre":""}},[e("span",{pre:!0,attrs:{class:"hljs-meta"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"bash"}},[a._v(" coffee -cm sample.coffee")])])]),e("ul",[e("li",[e("code",{pre:!0},[a._v("-c")]),a._v("：将CoffeeScript编译成JavaScript。")]),e("li",[e("code",{pre:!0},[a._v("-m")]),a._v("：生成SourceMap文件，后缀为"),e("code",{pre:!0},[a._v(".js.map")]),a._v("。")])]),e("p",[a._v("可以进一步将生成的代码压缩：")]),e("pre",{pre:!0,attrs:{class:"hljs lang-shell"}},[e("code",{pre:!0,attrs:{"v-pre":""}},[e("span",{pre:!0,attrs:{class:"hljs-meta"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"bash"}},[a._v(" uglifyjs sample.js -cm -o sample.min.js --"),e("span",{pre:!0,attrs:{class:"hljs-built_in"}},[a._v("source")]),a._v("-map=sample.min.map --"),e("span",{pre:!0,attrs:{class:"hljs-keyword"}},[a._v("in")]),a._v("-source-map=sample.js.map")])])]),e("p",[a._v("这样就可以将压缩后的代码"),e("code",{pre:!0},[a._v("sample.min.js")]),a._v("直接映射回CoffeeScript的原始代码"),e("code",{pre:!0},[a._v("sample.coffee")]),a._v("了。")]),e("p",[a._v("文章开头示例中的SourceMap就是这样生成的。")]),e("h3",{attrs:{id:"SourceMap的内容"}},[a._v("SourceMap的内容 "),e("a",{staticClass:"header-anchor",attrs:{href:"#SourceMap的内容","aria-hidden":"true",target:"_blank"}},[a._v("¶")])]),e("p",[a._v("打开SourceMap文件，它大概是这个样子：")]),e("pre",{pre:!0,attrs:{class:"hljs lang-json"}},[e("code",{pre:!0,attrs:{"v-pre":""}},[a._v('{\n    version: 3,\n    file: "out.js",\n    sourceRoot: "",\n    sources: ["foo.js", "bar.js"],\n    sourceContent: null,\n    names: ["src", "maps", "are", "fun"],\n    mappings: "AAgBC;SAAQ,CAAEA;EAAA,KAAG,QAAYC"\n}')])]),e("p",[a._v("整个文件就是JSON格式，主要有以下几个属性：")]),e("ul",[e("li",[e("code",{pre:!0},[a._v("version")]),a._v("：SourceMap的版本，目前为3；")]),e("li",[e("code",{pre:!0},[a._v("file")]),a._v("：转换后的文件名；")]),e("li",[e("code",{pre:!0},[a._v("sourceRoot")]),a._v("：转换前的文件所在的目录。如果与转换前的文件在同一目录，该项为空；")]),e("li",[e("code",{pre:!0},[a._v("sources")]),a._v("：转换前的文件。该项是一个数组，表示可能存在多个文件合并的情况；")]),e("li",[e("code",{pre:!0},[a._v("sourceContent")]),a._v("：转换前文件的内容。当没有配置"),e("code",{pre:!0},[a._v("sources")]),a._v("的时候会使用该项；")]),e("li",[e("code",{pre:!0},[a._v("names")]),a._v("：转换前的所有变量名和属性名；")]),e("li",[e("code",{pre:!0},[a._v("mappings")]),a._v("：记录位置信息的映射表，下文详细介绍。")])]),e("h4",{attrs:{id:"mappings属性"}},[a._v("mappings属性 "),e("a",{staticClass:"header-anchor",attrs:{href:"#mappings属性","aria-hidden":"true",target:"_blank"}},[a._v("¶")])]),e("p",[a._v("这部分才是真正有趣的部分，从这里可以看到代码转换前后中各个位置是如何对应的。")]),e("p",[a._v("mappings属性是一个很长的字符串，它分成三级。")]),e("ul",[e("li",[a._v("mappings字符串用"),e("code",{pre:!0},[a._v(";")]),a._v("分割的一组对应生成代码中的一行；")]),e("li",[a._v("每一组用"),e("code",{pre:!0},[a._v(",")]),a._v("分割的一段对应生成代码中的一个位置信息；")]),e("li",[a._v("每一段里是5个数字的Base64 VLQ编码，比如"),e("code",{pre:!0},[a._v("[9,0,0,1,1]")]),a._v("这5个数字的编码是"),e("code",{pre:!0},[a._v("SAACC")]),a._v("：\n"),e("ul",[e("li",[a._v("第0个数字，表示这个位置在生成代码的第几列；")]),e("li",[a._v("第1个数字，表示这个位置属于sources属性中的哪一个文件；")]),e("li",[a._v("第2个数字，表示这个位置属于原始代码的第几行；")]),e("li",[a._v("第3个数字，表示这个位置属于原始代码的第几列；")]),e("li",[a._v("第4个数字，表示这个位置属于names属性中的哪一个变量。这个数字不是必需的，可以省略。")]),e("li",[a._v("由于Base64 VLQ编码是变长的，所以每一段可以由多个字符构成。")])])])]),e("p",[a._v("关于Base64 VLQ编码本文不再详述，其实并不复杂，请参考："),e("a",{attrs:{href:"http://blog.allenm.me/2012/12/base64-vlq-encoding",target:"_blank"}},[a._v("Base64 VLQ编码规则")]),a._v("，"),e("a",{attrs:{href:"https://github.com/mozilla/source-map/blob/master/lib/source-map/base64-vlq.js",target:"_blank"}},[a._v("SourceMap中VLQ编码的JS实现")]),a._v("，"),e("a",{attrs:{href:"http://murzwin.com/base64vlq.html",target:"_blank"}},[a._v("VLQ在线编码解码工具")])]),e("h5",{attrs:{id:"示例1"}},[a._v("示例1 "),e("a",{staticClass:"header-anchor",attrs:{href:"#示例1","aria-hidden":"true",target:"_blank"}},[a._v("¶")])]),e("p",[a._v("假设mappings属性的内容如下：")]),e("pre",{pre:!0,attrs:{class:"hljs lang-json"}},[e("code",{pre:!0,attrs:{"v-pre":""}},[a._v('mappings: ";AAAA;AAAA,MAAA,SAAA;AACX,QAAA,UAAA"')])]),e("p",[a._v("这表示生成代码分成4行，第0行为空行，第1行有1个位置信息，第2行有3个位置信息，第3行有3个位置信息。")]),e("h5",{attrs:{id:"示例2"}},[a._v("示例2 "),e("a",{staticClass:"header-anchor",attrs:{href:"#示例2","aria-hidden":"true",target:"_blank"}},[a._v("¶")])]),e("p",[a._v("我们将文章开头示例中的Map文件的mappings属性拿过来试一下：")]),e("pre",{pre:!0,attrs:{class:"hljs lang-json"}},[e("code",{pre:!0,attrs:{"v-pre":""}},[a._v('mappings: "CAAA,WAAA,GAAAA,EAAAA,GAAY,SAACC,GACZ"')])]),e("p",[a._v("这例子中的生成代码只有1行。我们使用"),e("a",{attrs:{href:"http://murzwin.com/base64vlq.html",target:"_blank"}},[a._v("VLQ在线编码解码工具")]),a._v("把内容解码一下：")]),e("pre",{pre:!0,attrs:{class:"hljs lang-json"}},[e("code",{pre:!0,attrs:{"v-pre":""}},[a._v("[1,0,0,0], [11,0,0,0], [3,0,0,0,0], [2,0,0,0,0], [3,0,0,12], [9,0,0,1,1], [3,0,1,-12]")])]),e("p",[a._v("__注意：__每组值都是相对于前一组值的。")]),e("p",[a._v("每一组加上前一组的值可以得到：")]),e("pre",{pre:!0,attrs:{class:"hljs lang-json"}},[e("code",{pre:!0,attrs:{"v-pre":""}},[a._v("[1,0,0,0], [12,0,0,0], [15,0,0,0,0], [17,0,0,0,0], [20,0,0,12], [29,0,0,13,1], [32,0,1,1,1]")])]),e("p",[a._v("整理一下可以得出如下结果：")]),e("p",[e("code",{pre:!0},[a._v("(a,b)=>name(m,n)")]),a._v("表示生成代码中的a行b列对应原始代码中的m行n列的位置，并且在原始代码中这个位置的变量名是name。")]),e("pre",{pre:!0,attrs:{class:"hljs"}},[e("code",{pre:!0,attrs:{"v-pre":""}},[a._v("(0,1)=>(0,0)\n(0,12)=>(0,0)\n(0,15)=>factorial(0,0)\n(0,17)=>factorial(0,0)\n(0,20)=>(0,12)\n(0,29)=>num(0,13)\n(0,32)=>num(1,1)")])]),e("p",[a._v("大家可以根据开头的示例代码验证一下上面的结果。")]),e("hr"),e("h6",{attrs:{id:"扩展阅读"}},[a._v("扩展阅读 "),e("a",{staticClass:"header-anchor",attrs:{href:"#扩展阅读","aria-hidden":"true",target:"_blank"}},[a._v("¶")])]),e("ul",[e("li",[e("a",{attrs:{href:"https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit",target:"_blank"}},[a._v("SourceMap文档")])]),e("li",[e("a",{attrs:{href:"https://github.com/mozilla/source-map",target:"_blank"}},[a._v("[GitHub] 此库可以生成SourceMap")])])]),e("h6",{attrs:{id:"参考"}},[a._v("参考 "),e("a",{staticClass:"header-anchor",attrs:{href:"#参考","aria-hidden":"true",target:"_blank"}},[a._v("¶")])]),e("ul",[e("li",[e("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html",target:"_blank"}},[a._v("JavaScript SourceMap 详解")])]),e("li",[e("a",{attrs:{href:"http://blog.allenm.me/2012/12/whats-sourcemap",target:"_blank"}},[a._v("[Allen.M] 使用 SourceMap 来进行前端代码调试")])]),e("li",[e("a",{attrs:{href:"http://www.alloyteam.com/2014/01/source-map-version-3-introduction",target:"_blank"}},[a._v("[AlloyTeam] source map 版本3介绍")])]),e("li",[e("a",{attrs:{href:"http://www.cnblogs.com/fsjohnhuang/p/4208566.html",target:"_blank"}},[a._v("前端构建：SourceMaps详解")])]),e("li",[e("a",{attrs:{href:"http://www.danding.net/2013/12/source-maps%E4%BB%8B%E7%BB%8D",target:"_blank"}},[a._v("SourceMaps介绍")])]),e("li",[e("a",{attrs:{href:"http://blogs.msdn.com/b/davrous/archive/2014/08/22/enhance-your-javascript-debugging-life-thanks-to-the-source-map-support-available-in-ie11-chrome-opera-amp-firefox.aspx",target:"_blank"}},[a._v("Enhance your JavaScript debugging life using IE11, Chrome, Opera & Firefox source map support")])])]),e("p",{staticClass:"u-article_footer"},[e("span",{staticClass:"u-article_tag"},[a._v("Source")]),e("span",{staticClass:"u-article_tag"},[a._v("Map")])])])},staticRenderFns:[]},t=e("OLXp")(null,r,!1,null,null,null);s.default=t.exports}});